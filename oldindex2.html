<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife Rescue Dashboard</title>
    <link rel="icon" href="https://ia601205.us.archive.org/12/items/icon_20250717/icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .modal-backdrop { backdrop-filter: blur(8px); }
        .status-critical-i { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-critical-ii { background: linear-gradient(135deg, #f97316, #ea580c); }
        .status-stable { background: linear-gradient(135deg, #10b981, #059669); }
        .status-recovering { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body class="min-h-screen bg-[url('de.jpg')] bg-no-repeat bg-fixed bg-center bg-cover">


    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-green-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                    <img src="2x2.gif" alt="icon" class="w-6 h-6" />
                    </div>

                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Wildlife Rescue Center</h1>
                        <p class="text-sm text-gray-600">Conservation & Rehabilitation Dashboard</p>
                        <p class="text-sm text-gray-600 italic">üìçSo. Mandaapan, Brgy. New Balamban, Tagum City, Davao del Norte</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-green-100 px-4 py-2 rounded-full">
                        <span class="text-green-800 font-medium" id="totalCount">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Filters -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex flex-wrap gap-4 items-center">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Species:</label>
                        <select id="speciesFilter" class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">All Species</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Status:</label>
                        <select id="statusFilter" class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">All Status</option>
                            <option value="Critical I">Critical I</option>
                            <option value="Critical II">Critical II</option>
                            <option value="Stable">Stable</option>
                            <option value="Recovering">Recovering</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Year:</label>
                        <select id="yearFilter" class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">All Years</option>
                        </select>
                    </div>

                    <button onclick="clearFilters()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg text-sm font-medium text-gray-700 transition-colors">
                        Clear Filters
                    </button>
                </div>
                <button onclick="toggleLegend()" class="bg-blue-100 hover:bg-blue-200 px-4 py-2 rounded-lg text-sm font-medium text-blue-700 transition-colors flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Legend</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Legend Panel -->
    <div id="legendPanel" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-6 hidden">
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 border border-blue-200 shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center space-x-2">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>Legend & Definitions</span>
                </h3>
                <button onclick="toggleLegend()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Health Status Legend -->
                <div class="bg-gradient-to-br from-red-50 to-green-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-900 mb-3 flex items-center space-x-2">
                        <div class="w-3 h-3 bg-gradient-to-r from-red-500 to-green-500 rounded-full"></div>
                        <span>Health Status</span>
                    </h4>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white status-critical-i flex-shrink-0">Critical I</span>
                            <p class="text-gray-700">Exhibits signs of weakness, visible injuries, etc., under close observation</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white status-critical-ii flex-shrink-0">Critical II</span>
                            <p class="text-gray-700">Severely debilitated or extremely weak; requires urgent veterinary intervention</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white status-recovering flex-shrink-0">Recovering</span>
                            <p class="text-gray-700">Improving from previous injury, illness, or weakness; shows signs of healing but not yet fully stable</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white status-stable flex-shrink-0">Stable I</span>
                            <p class="text-gray-700">Healthy but still under close observation; may need monitoring to ensure recovery/adaptation</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white status-stable flex-shrink-0">Stable II</span>
                            <p class="text-gray-700">Healthy and stable, exhibiting normal activity and behavior; ready for release</p>
                        </div>
                    </div>
                </div>

                <!-- Biogeography Status Legend -->
                <div class="bg-gradient-to-br from-orange-50 to-purple-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-900 mb-3 flex items-center space-x-2">
                        <div class="w-3 h-3 bg-gradient-to-r from-orange-500 to-purple-500 rounded-full"></div>
                        <span>Biogeography Status</span>
                    </h4>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-orange-600 text-white flex-shrink-0">Endemic</span>
                            <p class="text-gray-700">Species that are found only in the Philippines and nowhere else in the world</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-600 text-white flex-shrink-0">Native</span>
                            <p class="text-gray-700">Species that naturally occur in the Philippines but are also distributed in other countries</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-purple-600 text-white flex-shrink-0">Introduced</span>
                            <p class="text-gray-700">Species not naturally found in the Philippines, brought in through human activity (pet trade, etc.)</p>
                        </div>
                    </div>
                </div>

                <!-- Release Methods Legend -->
                <div class="bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-900 mb-3 flex items-center space-x-2">
                        <div class="w-3 h-3 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full"></div>
                        <span>Release Methods</span>
                    </h4>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-teal-600 text-white flex-shrink-0">Hard Release</span>
                            <p class="text-gray-700">Direct release into the wild without transitional support or monitoring</p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-cyan-600 text-white flex-shrink-0">Soft Release</span>
                            <p class="text-gray-700">Gradual release with temporary enclosures, feeding support, and close monitoring</p>
                        </div>
                    </div>
                </div>

                <!-- IUCN Conservation Status -->
                <div class="bg-gradient-to-br from-yellow-50 to-red-50 rounded-xl p-4">
                    <h4 class="font-semibold text-gray-900 mb-3 flex items-center space-x-2">
                        <div class="w-3 h-3 bg-gradient-to-r from-yellow-500 to-red-500 rounded-full"></div>
                        <span>IUCN Conservation Status</span>
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-green-600 text-white flex-shrink-0">LC</span>
                            <span class="text-gray-700">Least Concern</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-600 text-white flex-shrink-0">NT</span>
                            <span class="text-gray-700">Near Threatened</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-orange-600 text-white flex-shrink-0">VU</span>
                            <span class="text-gray-700">Vulnerable</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-red-600 text-white flex-shrink-0">EN</span>
                            <span class="text-gray-700">Endangered</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-red-800 text-white flex-shrink-0">CR</span>
                            <span class="text-gray-700">Critically Endangered</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="bg-white rounded-2xl overflow-hidden shadow-lg border border-gray-800">
                <div class="loading-shimmer h-48"></div>
                <div class="p-4">
                    <div class="loading-shimmer h-4 rounded mb-2"></div>
                    <div class="loading-shimmer h-3 rounded w-3/4"></div>
                </div>
            </div>
            <div class="bg-white rounded-2xl overflow-hidden shadow-lg border-2 border-gray-500">
  <div class="loading-shimmer h-48"></div>
  <div class="p-4">
    <div class="loading-shimmer h-4 rounded mb-2"></div>
    <div class="loading-shimmer h-3 rounded w-3/4"></div>
  </div>
</div>

            </div>
            <div class="bg-white rounded-2xl overflow-hidden shadow-lg border-2 border-gray-500">
  <div class="loading-shimmer h-48"></div>
  <div class="p-4">
    <div class="loading-shimmer h-4 rounded mb-2"></div>
    <div class="loading-shimmer h-3 rounded w-3/4"></div>
  </div>
</div>

            </div>
        </div>
    </div>

    <!-- Cards Grid -->
    <div id="cardsContainer" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 hidden">
        <div id="cardsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards will be populated here -->
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop bg-black/50 absolute inset-0" onclick="closeModal()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div id="modalContent">
                    <!-- Modal content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Species Information Modal -->
    <div id="speciesModal" class="fixed inset-0 z-60 hidden">
        <div class="modal-backdrop bg-black/60 absolute inset-0" onclick="closeSpeciesModal()"></div>
        <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div id="speciesModalContent">
                    <!-- Species modal content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let filteredData = [];

        // CSV parsing function
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }
            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        // Handle escaped quotes
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim().replace(/^"|"$/g, ''));
            return result;
        }

        // Load and parse CSV data
        async function loadData() {
            try {
                // Try multiple URLs for the CSV data
                const urls = [
                    'https://docs.google.com/spreadsheets/d/e/2PACX-1vTtbl6w2Cu44Sj3NocFki0q43pIkSIYKNpDMHpLy_IzqeAv3MEZzioXuZsarU7tmFvbtq-qIsBmVq4L/pub?gid=0&single=true&output=csv',
                    'https://docs.google.com/spreadsheets/d/1tbl6w2Cu44Sj3NocFki0q43pIkSIYKNpDMHpLy_IzqeAv3M/export?format=csv&gid=0'
                ];
                
                let csvText = '';
                
                // Try each URL until one works
                for (const url of urls) {
                    try {
                        console.log('Attempting to load data from:', url);
                        const response = await fetch(url);
                        csvText = await response.text();
                        
                        // Check if we got valid CSV data
                        if (csvText && csvText.length > 100 && csvText.includes('Year Turned-Over')) {
                            console.log('Successfully loaded data from:', url);
                            break;
                        }
                    } catch (e) {
                        console.log('Failed to load from:', url, e);
                    }
                }
                
                // If no data loaded from external sources, use sample data
                if (!csvText || csvText.length < 100 || !csvText.includes('Year Turned-Over')) {
                    console.log('No data loaded from external sources, using sample data for demonstration');
                    csvText = `"Year Turned-Over","Day-Month Turned-Over","Acceptance Form Number","Sex","Common Name","Scientific Name","Photo","Nickname (if any)","Cage No.","Health Status","Remarks","Candidate for Release","Deceased","Date","Probable Cause of Death","Release Date","Release Location","Turned-Over By","Office/Address","Species Description","Biogeography Staus","IUCN Status","Medical Treatments Administered","Manner of Release"
"2019","24-May","WRC-D-005-2019-23","Male","Long Tailed Macaque","Macaca fascicularis","https://images.unsplash.com/photo-1540573133985-87b6da6d54a9?w=300&h=200&fit=crop","Charlie","24","Critical II","Injured left arm from trap","Not Yet","No","","","","","Dr. Maria Santos","Barangay Health Center Quezon City","https://en.wikipedia.org/wiki/Crab-eating_macaque","Endemic","Least Concern","https://example.com/medical-treatments/antibiotics-wound-care","Soft release"
"2019","2-Aug","WRC-D-008-2019-37","Male","Long Tailed Macaque","Macaca fascicularis","https://images.unsplash.com/photo-1540573133985-87b6da6d54a9?w=300&h=200&fit=crop","Junjun","26","Critical I","Severe dehydration and malnutrition","Not Yet","No","","","","","Local Farmer Juan Cruz","Sitio Malaki Laguna","Medium-sized primate with long tail highly adaptable to various habitats","Endemic","Least Concern","https://example.com/medical-treatments/iv-fluids-nutrition","Hard release"
"2020","15-Mar","WRC-D-012-2020-45","Female","Philippine Eagle","Pithecophaga jefferyi","https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=300&h=200&fit=crop","Aguila","12","Stable","Recovering well from wing injury","Yes","No","","","15-Apr-2020","14.2456 121.0467","DENR Officer Rodriguez","DENR Regional Office IV-A","https://en.wikipedia.org/wiki/Philippine_eagle","Endemic","Critically Endangered","https://example.com/medical-treatments/wing-splinting-therapy","Soft release with monitoring"
"2020","8-Jun","WRC-D-018-2020-52","Male","Tarsier","Carlito syrichta","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Tiny","8","Recovering","Good progress with eye treatment","Not Yet","No","","","","","Wildlife Photographer Ana Reyes","Bohol Tourism Office","https://en.wikipedia.org/wiki/Philippine_tarsier","Endemic","Near Threatened","https://example.com/medical-treatments/eye-drops-antibiotics","Soft release"
"2021","12-Jan","WRC-D-003-2021-15","Female","Binturong","Arctictis binturong","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Blackie","15","Critical I","Needs intensive care for respiratory issues","Not Yet","No","","","","","Park Ranger Miguel Torres","Subic Bay Forest Reserve","https://en.wikipedia.org/wiki/Binturong","Native","Vulnerable","https://example.com/medical-treatments/respiratory-therapy","Hard release"
"2021","5-Apr","WRC-D-007-2021-28","Female","Philippine Deer","Rusa marianna","https://images.unsplash.com/photo-1551892374-ecf8754cf8b0?w=300&h=200&fit=crop","Bambi","3","Stable","Orphaned fawn doing well","Yes","No","","","22-May-2021","13.7565 121.0583","Concerned Citizen Lisa Garcia","Barangay San Isidro Batangas","Medium-sized deer species endemic to the Philippines","Endemic","Vulnerable","https://example.com/medical-treatments/milk-formula-vaccination","Direct release to protected area"
"2021","18-Jul","WRC-D-011-2021-34","Male","Monitor Lizard","Varanus salvator","https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop","Rex","19","Recovering","Tail injury healing nicely","Not Yet","No","","","","","Fisherman Roberto Dela Cruz","Coastal Barangay Palawan","Large semi-aquatic lizard excellent swimmer and climber","Native","Least Concern","https://example.com/medical-treatments/wound-care-antibiotics","Soft release"
"2022","3-Feb","WRC-D-002-2022-08","Female","Flying Lemur","Cynocephalus volans","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Glider","7","Critical II","Electrocution from power lines","Not Yet","No","","","","","Electric Company Worker Carlos Mendez","Meralco Substation Manila","Gliding mammal with membrane between limbs strictly arboreal","Endemic","Least Concern","https://example.com/medical-treatments/burn-treatment-pain-management","Hard release"
"2022","14-May","WRC-D-009-2022-41","Male","Pangolin","Manis javanica","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Armor","22","Stable","Rescued from illegal trade","Yes","No","","","8-Jun-2022","14.6760 121.0437","NBI Agent Patricia Lim","National Bureau of Investigation","Scaly anteater with protective armor feeds exclusively on ants and termites","Native","Critically Endangered","https://example.com/medical-treatments/stress-reduction-therapy","Soft release with GPS tracking"
"2022","29-Aug","WRC-D-015-2022-56","Female","Hornbill","Buceros hydrocorax","https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=300&h=200&fit=crop","Bella","11","Recovering","Broken beak repair successful","Not Yet","No","","","","","Forest Guard Elena Ramos","Mt. Makiling Forest Reserve","Large frugivorous bird with distinctive casque important seed disperser","Endemic","Near Threatened","https://example.com/medical-treatments/beak-reconstruction-surgery","Soft release"
"2023","10-Jan","WRC-D-001-2023-03","Male","Civet Cat","Paradoxurus hermaphroditus","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Shadow","16","Critical I","Hit by vehicle severe internal injuries","Not Yet","Yes","15-Jan-2023","Internal bleeding","","","Veterinarian Dr. Jose Mercado","Animal Hospital Cebu City","Nocturnal omnivore with masked face excellent climber","Native","Least Concern","https://example.com/medical-treatments/emergency-surgery-blood-transfusion","Hard release"
"2023","22-Mar","WRC-D-006-2023-19","Female","Sea Turtle","Chelonia mydas","https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=300&h=200&fit=crop","Marina","1","Stable","Plastic ingestion treated successfully","Yes","No","","","10-Apr-2023","14.5906 120.9777","Marine Biologist Dr. Sarah Chen","Marine Science Institute UP Diliman","Large marine reptile herbivorous as adult important for marine ecosystems","Migratory","Endangered","https://example.com/medical-treatments/endoscopic-plastic-removal","Beach release with satellite tag"
"2023","7-Jun","WRC-D-010-2023-33","Male","Fruit Bat","Pteropus vampyrus","https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=300&h=200&fit=crop","Batman","5","Recovering","Wing membrane tear healing well","Not Yet","No","","","","","Cave Explorer Mark Johnson","Philippine Speleological Society","Large fruit bat with 1.5m wingspan important pollinator and seed disperser","Native","Near Threatened","https://example.com/medical-treatments/wing-membrane-repair","Soft release"
"2023","19-Sep","WRC-D-014-2023-47","Female","Wild Boar","Sus scrofa","https://images.unsplash.com/photo-1551892374-ecf8754cf8b0?w=300&h=200&fit=crop","Wilma","20","Critical II","Snare trap wounds on legs","Not Yet","No","","","","","Hunter Association Rep. Tony Valdez","Hunters Association Mindanao","Omnivorous ungulate important ecosystem engineer","Native","Least Concern","https://example.com/medical-treatments/wound-debridement-antibiotics","Hard release"
"2024","4-Feb","WRC-D-004-2024-12","Male","Reticulated Python","Malayopython reticulatus","https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop","Monty","25","Stable","Skin infection cleared up","Yes","No","","","","","Herpetologist Dr. Amanda Cruz","University of the Philippines Los Ba√±os","Large non-venomous constrictor important predator in ecosystem","Native","Least Concern","https://example.com/medical-treatments/antifungal-treatment","Direct release to suitable habitat"`;
                }
                
                const data = parseCSV(csvText);
                console.log('Parsed data rows:', data.length);
                console.log('First row headers:', Object.keys(data[0] || {}));
                
                allData = data.map((row, index) => ({
                    id: index,
                    year: row['Year Turned-Over'] || '',
                    date: row['Day-Month Turned-Over'] || '',
                    formNumber: row['Acceptance Form Number'] || '',
                    sex: row['Sex'] || '',
                    commonName: row['Common Name'] || '',
                    scientificName: row['Scientific Name'] || '',
                    photo: row['Photo'] || 'https://via.placeholder.com/300x200?text=No+Image',
                    nickname: row['Nickname (if any)'] || '',
                    cageNo: row['Cage No.'] || '',
                    healthStatus: row['Health Status'] || '',
                    remarks: row['Remarks'] || '',
                    candidateForRelease: row['Candidate for Release'] || '',
                    deceased: row['Deceased'] || '',
                    deathDate: row['Date of Death'] || row['Date'] || '',
                    causeOfDeath: row['Probable Cause of Death'] || '',
                    releaseDate: row['Release Date'] || '',
                    releaseLocation: row['Release Location'] || '',
                    turnedOverBy: row['Turned-Over By'] || '',
                    officeAddress: row['Office/Address'] || '',
                    speciesDescription: row['Species Description'] || '',
                    biogeographyStatus: row['Biogeography Staus'] || '',
                    iucnStatus: row['IUCN Status'] || '',
                    medicalTreatments: row['Medical Treatments Administered'] || '',
                    mannerOfRelease: row['Manner of Release'] || ''
                }));

                filteredData = [...allData];
                populateFilters();
                renderCards();
                updateTotalCount();
                
                // Hide loading, show content
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('cardsContainer').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').innerHTML = '<div class="text-center py-12"><p class="text-red-600">Error loading data. Please try again later.</p></div>';
            }
        }

        function populateFilters() {
            // Populate species filter
            const species = [...new Set(allData.map(item => item.commonName))].filter(Boolean).sort();
            const speciesSelect = document.getElementById('speciesFilter');
            species.forEach(s => {
                const option = document.createElement('option');
                option.value = s;
                option.textContent = s;
                speciesSelect.appendChild(option);
            });

            // Populate year filter
            const years = [...new Set(allData.map(item => item.year))].filter(Boolean).sort((a, b) => b - a);
            const yearSelect = document.getElementById('yearFilter');
            years.forEach(y => {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y;
                yearSelect.appendChild(option);
            });


        }

        function getStatusClass(status) {
            switch(status) {
                case 'Critical I': return 'status-critical-i';
                case 'Critical II': return 'status-critical-ii';
                case 'Stable': return 'status-stable';
                case 'Recovering': return 'status-recovering';
                default: return 'bg-gray-500';
            }
        }

        function getIUCNStatusClass(status) {
            switch(status) {
                case 'Least Concern': return 'bg-green-600 text-white';
                case 'Near Threatened': return 'bg-yellow-600 text-white';
                case 'Vulnerable': return 'bg-orange-600 text-white';
                case 'Endangered': return 'bg-red-600 text-white';
                case 'Critically Endangered': return 'bg-red-800 text-white';
                default: return 'bg-gray-600 text-white';
            }
        }

        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';

            filteredData.forEach(animal => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-2xl overflow-hidden shadow-lg card-hover cursor-pointer';
                card.onclick = () => openModal(animal);
                
                card.innerHTML = `
                    <div class="relative">
                        <img src="${animal.photo}" alt="${animal.commonName}" 
                             class="w-full h-64 object-contain bg-gray-100"
                             onerror="this.src='https://via.placeholder.com/300x400/10b981/ffffff?text=${encodeURIComponent(animal.commonName || 'Wildlife')}'; this.alt='Placeholder image';">
                        <div class="absolute top-3 right-3">
                            <span class="px-2 py-1 rounded-full text-xs font-medium text-white ${getStatusClass(animal.healthStatus)}">
                                ${animal.healthStatus || 'Unknown'}
                            </span>
                        </div>
                        ${animal.nickname ? `<div class="absolute top-3 left-3 bg-black/70 text-white px-2 py-1 rounded-full text-xs">${animal.nickname}</div>` : ''}
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">${animal.commonName || 'Unknown Species'}</h3>
                        <p class="text-sm text-gray-600 italic mb-2">${animal.scientificName || ''}</p>
                        <div class="flex items-center justify-between text-xs text-gray-500">
                            <span>${animal.sex || 'Unknown'}</span>
                            <span>Cage ${animal.cageNo || 'N/A'}</span>
                        </div>
                        <div class="mt-2 flex items-center justify-between">
                            <span class="text-xs text-gray-500">${animal.year} ‚Ä¢ ${animal.date}</span>
                            ${animal.iucnStatus ? `<span class="px-2 py-1 rounded-full text-xs font-medium ${getIUCNStatusClass(animal.iucnStatus)}">${animal.iucnStatus}</span>` : ''}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function openModal(animal) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="relative">
                    <button onclick="closeModal()" class="absolute top-4 right-4 z-10 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-black/70 transition-colors">
                        ‚úï
                    </button>
                    <img src="${animal.photo}" alt="${animal.commonName}" 
                         class="w-full h-80 object-contain bg-gray-100"
                         onerror="this.src='https://via.placeholder.com/600x800/10b981/ffffff?text=${encodeURIComponent(animal.commonName || 'Wildlife')}'; this.alt='Placeholder image';">
                    <div class="absolute bottom-4 left-4">
                        <span class="px-3 py-1 rounded-full text-sm font-medium text-white ${getStatusClass(animal.healthStatus)}">
                            ${animal.healthStatus || 'Unknown Status'}
                        </span>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 mb-1">${animal.commonName || 'Unknown Species'}</h2>
                            <p class="text-lg text-gray-600 italic">${animal.scientificName || 'Not specified'}</p>
                            <p class="text-sm text-green-600 font-medium mt-1">Nickname: ${animal.nickname || 'None assigned'}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-3">Basic Information</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Year Turned-Over:</span>
                                        <span class="font-medium">${animal.year || 'Not recorded'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Day-Month Turned-Over:</span>
                                        <span class="font-medium">${animal.date || 'Not recorded'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Acceptance Form Number:</span>
                                        <span class="font-medium">${animal.formNumber || 'Not assigned'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Sex:</span>
                                        <span class="font-medium">${animal.sex || 'Unknown'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Common Name:</span>
                                        <span class="font-medium">${animal.commonName || 'Unknown Species'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Scientific Name:</span>
                                        <span class="font-medium italic">${animal.scientificName || 'Not specified'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Cage Number:</span>
                                        <span class="font-medium">${animal.cageNo || 'Not assigned'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h3 class="font-semibold text-purple-900 mb-3">Submission Details</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-purple-600">Turned-Over By:</span>
                                        <span class="font-medium">${animal.turnedOverBy || 'Not recorded'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-purple-600">Office/Address:</span>
                                        <span class="font-medium">${animal.officeAddress || 'Not specified'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-3">Health & Status</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Health Status:</span>
                                        <span class="font-medium">${animal.healthStatus || 'Not assessed'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Candidate for Release:</span>
                                        <span class="font-medium ${animal.candidateForRelease === 'Yes' ? 'text-green-600' : animal.candidateForRelease === 'No' ? 'text-red-600' : 'text-orange-600'}">${animal.candidateForRelease || 'Under evaluation'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Current Status:</span>
                                        <span class="font-medium ${animal.deceased === 'Yes' ? 'text-red-600' : 'text-green-600'}">${animal.deceased === 'Yes' ? 'Deceased' : 'Alive'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Release Date:</span>
                                        <span class="font-medium">${animal.releaseDate || 'Not released yet'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Manner of Release:</span>
                                        <span class="font-medium">${animal.mannerOfRelease || 'Not specified'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Release Location:</span>
                                        <span class="font-medium">${animal.releaseLocation || 'Not specified'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-orange-50 rounded-lg p-4">
                                <h3 class="font-semibold text-orange-900 mb-3">Conservation Status</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-orange-600">Biogeography Status:</span>
                                        <span class="font-medium">${animal.biogeographyStatus || 'Not assessed'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-orange-600">IUCN Status:</span>
                                        <span class="font-medium">${animal.iucnStatus || 'Not listed'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-teal-50 rounded-lg p-4">
                        <h3 class="font-semibold text-teal-900 mb-2">Species Description</h3>
                        ${animal.speciesDescription && animal.speciesDescription !== '-' && animal.speciesDescription.startsWith('http') ? `
                            <div class="flex items-center space-x-2">
                                <a href="${animal.speciesDescription}" target="_blank" rel="noopener noreferrer" 
                                   class="text-sm text-teal-600 hover:text-teal-800 underline hover:no-underline transition-colors flex items-center space-x-1">
                                    <span>View detailed species information</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </a>
                            </div>
                        ` : `
                            <p class="text-sm text-teal-700">${animal.speciesDescription && animal.speciesDescription !== '-' ? animal.speciesDescription : 'No species description available'}</p>
                        `}
                    </div>
                    
                    <div class="mt-6 bg-indigo-50 rounded-lg p-4">
                        <h3 class="font-semibold text-indigo-900 mb-2">Medical Treatments Administered</h3>
                        ${animal.medicalTreatments && animal.medicalTreatments !== '-' ? `
                            <div class="flex items-center space-x-2">
                                <a href="${animal.medicalTreatments}" target="_blank" rel="noopener noreferrer" 
                                   class="text-sm text-indigo-600 hover:text-indigo-800 underline hover:no-underline transition-colors flex items-center space-x-1">
                                    <span>${animal.medicalTreatments}</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </a>
                            </div>
                        ` : `
                            <p class="text-sm text-indigo-700">No medical treatments recorded</p>
                        `}
                    </div>
                    
                    <div class="mt-6 bg-blue-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Remarks</h3>
                        <p class="text-sm text-gray-700">${animal.remarks && animal.remarks !== '-' ? animal.remarks : 'No remarks recorded yet'}</p>
                    </div>
                    
                    <div class="mt-6 bg-red-50 rounded-lg p-4">
                        <h3 class="font-semibold text-red-900 mb-2">Mortality Information</h3>
                        <div class="text-sm text-red-700 space-y-1">
                            <p><strong>Deceased:</strong> ${animal.deceased || 'No'}</p>
                            <p><strong>Date of Death:</strong> ${(animal.deathDate && animal.deathDate.trim() !== '') ? animal.deathDate : 'N/A'}</p>
                            <p><strong>Probable Cause of Death:</strong> ${(animal.causeOfDeath && animal.causeOfDeath.trim() !== '') ? animal.causeOfDeath : 'N/A'}</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-green-50 rounded-lg p-4">
                        <h3 class="font-semibold text-green-900 mb-3">Release Location</h3>
                        ${animal.releaseLocation && animal.releaseLocation !== 'Not specified' ? `
                            <p class="text-sm text-green-700 mb-3"><strong>Location:</strong> ${animal.releaseLocation}</p>
                            <div class="bg-white rounded-lg overflow-hidden border border-green-200">
                                <div id="map-${animal.id}" style="height: 200px; width: 100%;"></div>
                                <div class="p-2 text-xs text-gray-500 bg-gray-50">
                                    ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" class="text-blue-600 hover:underline">OpenStreetMap</a> contributors
                                </div>
                            </div>
                        ` : `
                            <p class="text-sm text-gray-600">No release location recorded yet</p>
                            <div class="bg-gray-100 rounded-lg p-8 text-center text-gray-400 mt-3">
                                <p>üó∫Ô∏è</p>
                                <p class="text-xs mt-2">Map will appear when release location is added</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Initialize map if release location exists
            if (animal.releaseLocation && animal.releaseLocation !== 'Not specified') {
                setTimeout(() => {
                    initializeMap(animal);
                }, 100);
            }
        }

        function initializeMap(animal) {
            const mapId = `map-${animal.id}`;
            const mapContainer = document.getElementById(mapId);
            
            if (!mapContainer) return;
            
            // Parse coordinates from location string
            let lat = 14.5995; // Default to Manila, Philippines
            let lng = 120.9842;
            
            const location = animal.releaseLocation;
            
            // Check if location contains coordinates (format: "lat, lng" or "lat,lng")
            const coordMatch = location.match(/(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)/);
            if (coordMatch) {
                lat = parseFloat(coordMatch[1]);
                lng = parseFloat(coordMatch[2]);
            }
            
            // Initialize the map
            const map = L.map(mapId).setView([lat, lng], 10);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add marker
            const marker = L.marker([lat, lng]).addTo(map);
            
            // Add popup with location info
            marker.bindPopup(`
                <div class="text-center">
                    <strong>${animal.commonName}</strong><br>
                    <small>Release Location</small><br>
                    ${location}
                </div>
            `).openPopup();
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function openSpeciesModal(url, commonName, scientificName) {
            const modal = document.getElementById('speciesModal');
            const content = document.getElementById('speciesModalContent');
            
            content.innerHTML = `
                <div class="relative">
                    <button onclick="closeSpeciesModal()" class="absolute top-4 right-4 z-10 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-black/70 transition-colors">
                        ‚úï
                    </button>
                    <div class="bg-gradient-to-r from-teal-500 to-emerald-600 text-white p-6">
                        <h2 class="text-2xl font-bold mb-2">${commonName}</h2>
                        <p class="text-lg italic opacity-90">${scientificName}</p>
                        <p class="text-sm opacity-75 mt-2">Species Information</p>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <div class="flex items-center space-x-2 mb-3">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h3 class="font-semibold text-blue-900">Loading Species Information</h3>
                        </div>
                        <p class="text-sm text-blue-700 mb-4">Fetching detailed information from external source...</p>
                        <div class="flex items-center space-x-2">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                            <span class="text-sm text-blue-600">Please wait...</span>
                        </div>
                    </div>
                    
                    <div id="speciesContent" class="min-h-[400px]">
                        <!-- Content will be loaded here -->
                    </div>
                    
                    <div class="mt-6 bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2">External Link</h3>
                        <div class="flex items-center space-x-2">
                            <a href="${url}" target="_blank" rel="noopener noreferrer" 
                               class="text-blue-600 hover:text-blue-800 underline hover:no-underline transition-colors flex items-center space-x-1">
                                <span>Open in new tab</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                </svg>
                            </a>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Source: ${url}</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Load content in iframe
            setTimeout(() => {
                loadSpeciesContent(url);
            }, 500);
        }

        function loadSpeciesContent(url) {
            const contentDiv = document.getElementById('speciesContent');
            
            // Create iframe to load the external content
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.className = 'w-full h-96 border border-gray-200 rounded-lg';
            iframe.style.minHeight = '400px';
            
            // Handle iframe load events
            iframe.onload = function() {
                const loadingDiv = contentDiv.parentElement.querySelector('.bg-blue-50');
                if (loadingDiv) {
                    loadingDiv.innerHTML = `
                        <div class="flex items-center space-x-2 mb-2">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <h3 class="font-semibold text-green-900">Species Information Loaded</h3>
                        </div>
                        <p class="text-sm text-green-700">External content loaded successfully below.</p>
                    `;
                    loadingDiv.className = 'bg-green-50 rounded-lg p-4 mb-6';
                }
            };
            
            iframe.onerror = function() {
                contentDiv.innerHTML = `
                    <div class="bg-red-50 rounded-lg p-6 text-center">
                        <svg class="w-12 h-12 text-red-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-red-900 mb-2">Unable to Load Content</h3>
                        <p class="text-sm text-red-700 mb-4">The external website cannot be displayed in this frame due to security restrictions.</p>
                        <p class="text-xs text-red-600">Please use the "Open in new tab" link above to view the species information.</p>
                    </div>
                `;
                
                const loadingDiv = contentDiv.parentElement.querySelector('.bg-blue-50');
                if (loadingDiv) {
                    loadingDiv.remove();
                }
            };
            
            contentDiv.appendChild(iframe);
        }

        function closeSpeciesModal() {
            document.getElementById('speciesModal').classList.add('hidden');
        }

        function applyFilters() {
            const speciesFilter = document.getElementById('speciesFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;

            filteredData = allData.filter(animal => {
                return (!speciesFilter || animal.commonName === speciesFilter) &&
                       (!statusFilter || animal.healthStatus === statusFilter) &&
                       (!yearFilter || animal.year == yearFilter);
            });

            renderCards();
            updateTotalCount();
        }

        function clearFilters() {
            document.getElementById('speciesFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('yearFilter').value = '';
            filteredData = [...allData];
            renderCards();
            updateTotalCount();
        }

        function updateTotalCount() {
            document.getElementById('totalCount').textContent = `${filteredData.length} Animals`;
        }

        // Event listeners
        document.getElementById('speciesFilter').addEventListener('change', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('yearFilter').addEventListener('change', applyFilters);

        function toggleLegend() {
            const legendPanel = document.getElementById('legendPanel');
            legendPanel.classList.toggle('hidden');
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeSpeciesModal();
            }
        });

        // Load data on page load
        loadData();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a3731d5112fedd',t:'MTc1NzA1MTQzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>

<script>
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.onkeydown = function(e) {
    if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 'I'.charCodeAt(0))) {
      return false;
    }
  };
</script>

</body>
</html>
