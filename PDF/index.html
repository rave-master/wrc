<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife Rehabilitation Document Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .content {
            padding: 40px;
            background: white;
        }

        .document-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .document-paragraph {
            margin-bottom: 15px;
            text-align: justify;
            font-size: 1rem;
            color: #2c3e50;
        }

        .case-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #667eea;
            margin-bottom: 25px;
        }

        .case-info p {
            margin-bottom: 8px;
        }

        .case-info strong {
            color: #2c3e50;
            font-weight: 600;
        }

        .treatment-entry {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .treatment-date {
            font-size: 1.1rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 5px;
        }

        .treatment-details {
            margin-bottom: 10px;
        }

        .observation-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-style: italic;
            color: #856404;
        }

        .critical-note {
            background: #fee;
            border: 1px solid #fecaca;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            color: #c53030;
            font-weight: 600;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            display: block;
            margin: 30px auto 0;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .data-entry-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 5px; letter-spacing: 1px;">DEPARTMENT OF ENVIRONMENT AND NATURAL RESOURCES</h2>
                <h3 style="font-size: 1.1rem; font-weight: 400; margin-bottom: 15px; opacity: 0.9; letter-spacing: 0.5px;">KAGAWARAN NG KAPALIGIRAN AT LIKAS YAMAN</h3>
                <div style="border-top: 2px solid rgba(255,255,255,0.3); border-bottom: 2px solid rgba(255,255,255,0.3); padding: 10px 0; margin: 15px 0;">
                    <h1 style="font-size: 1.8rem; font-weight: 500; margin-bottom: 8px;">ü¶Ö Wildlife Rescue Center</h1>
                    <p style="font-size: 1rem; opacity: 0.9;">So. Mandaapan, Brgy. New Balamban, Tagum City, Davao del Norte</p>
                </div>
            </div>
            <h1 style="font-size: 2rem; margin-bottom: 10px; font-weight: 300;">Wildlife Rehabilitation Report</h1>
            <p style="font-size: 1rem; opacity: 0.9;">Medical Treatment Documentation</p>
        </div>

        <div class="content">
            <!-- Report Content Will Appear Here -->
            <div id="reportContent" style="text-align: center; padding: 40px; color: #6c757d;">
                <h3 style="margin-bottom: 20px;">üìã Ready to Generate Report</h3>
                <p>Please paste your wildlife acceptance form data below to generate a comprehensive rehabilitation report.</p>
            </div>

            <!-- Data Entry Section -->
            <div class="data-entry-section">
                <h2 class="section-title">Wildlife Acceptance Form Data</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Paste your acceptance form data here to update this report:</p>
                <textarea 
                    id="dataInput" 
                    placeholder="Paste your wildlife acceptance form data here (tab-separated format)..."
                    style="width: 100%; height: 150px; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; resize: vertical; background: white;"
                ></textarea>
                <div style="margin-top: 15px; display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="generate-btn" onclick="processNewData()" style="margin: 0; padding: 12px 25px; font-size: 1rem;">
                        üîÑ Update Report
                    </button>
                    <button class="generate-btn" onclick="startNewCase()" style="margin: 0; padding: 12px 25px; font-size: 1rem; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                        üÜï New Case
                    </button>
                    <button class="generate-btn" onclick="clearData()" style="margin: 0; padding: 12px 25px; font-size: 1rem; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
                        üóëÔ∏è Clear Data
                    </button>
                </div>
            </div>

            <button class="generate-btn" onclick="generatePDF()">
                üìÑ Generate PDF Report
            </button>
        </div>
    </div>

    <script>
        // Global variable to store current data
        let currentReportData = {
            caseId: '',
            commonName: '',
            scientificName: '',
            location: '',
            condition: '',
            weight: '',
            treatments: []
        };

        function processNewData() {
            const dataInput = document.getElementById('dataInput').value.trim();
            
            if (!dataInput) {
                alert('Please paste your wildlife acceptance form data first.');
                return;
            }

            try {
                const lines = dataInput.split('\n').filter(line => line.trim());
                const newData = parseWildlifeData(lines);
                
                if (newData) {
                    if (newData.caseId !== currentReportData.caseId) {
                        currentReportData = newData;
                        alert('New case data processed successfully! The report has been updated with the new patient information.');
                    } else {
                        currentReportData.treatments = [...currentReportData.treatments, ...newData.treatments];
                        alert(`Added ${newData.treatments.length} new treatment entries to existing case ${currentReportData.caseId}.`);
                    }
                    updateReportDisplay();
                    document.getElementById('dataInput').value = '';
                } else {
                    alert('Unable to parse the data. Please check the format and try again.');
                }
            } catch (error) {
                alert('Error processing data: ' + error.message);
            }
        }

        function parseWildlifeData(lines) {
            const treatments = [];
            let caseInfo = {};
            
            lines.forEach(line => {
                const fields = line.split('\t').map(field => field.trim()).filter(field => field !== '');
                
                if (fields.length >= 12) {
                    if (!caseInfo.caseId && fields[0]) {
                        caseInfo = {
                            caseId: fields[0] || 'N/A',
                            commonName: fields[1] || 'N/A',
                            scientificName: fields[2] || 'N/A',
                            location: fields[3] || 'N/A',
                            condition: fields[6] || 'N/A',
                            weight: 'N/A'
                        };
                    }
                    
                    if (fields[7]) {
                        treatments.push({
                            date: fields[4] || 'N/A',
                            time: fields[5] || '',
                            medication: fields[7] || 'N/A',
                            dosage: fields[8] || 'N/A',
                            classification: fields[9] || 'N/A',
                            route: fields[10] || 'N/A',
                            veterinarian: fields[11] || 'N/A',
                            observations: fields[12] || 'No observations recorded'
                        });
                    }
                }
            });
            
            if (treatments.length > 0 || caseInfo.caseId) {
                return {
                    ...caseInfo,
                    treatments: treatments
                };
            }
            
            return null;
        }

        function updateReportDisplay() {
            const reportContent = document.getElementById('reportContent');
            
            if (!currentReportData.caseId || currentReportData.treatments.length === 0) {
                reportContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <h3 style="margin-bottom: 20px;">üìã Ready to Generate Report</h3>
                        <p>Please paste your wildlife acceptance form data below to generate a comprehensive rehabilitation report.</p>
                    </div>
                `;
                return;
            }
            
            // Generate full report content
            reportContent.innerHTML = `
                <!-- Case Summary -->
                <div class="document-section">
                    <h2 class="section-title">Case Summary</h2>
                    <div class="case-info">
                        <p><strong>Case ID:</strong> ${currentReportData.caseId}</p>
                        <p><strong>Species:</strong> ${currentReportData.commonName} (<em>${currentReportData.scientificName}</em>)</p>
                        <p><strong>Location Found:</strong> ${currentReportData.location}</p>
                        <p><strong>Initial Condition:</strong> ${currentReportData.condition}</p>
                        <p><strong>Weight:</strong> ${currentReportData.weight}</p>
                    </div>
                    
                    <p class="document-paragraph">
                        This report documents the medical treatment and rehabilitation progress of a ${currentReportData.commonName} 
                        (<em>${currentReportData.scientificName}</em>) admitted to the Wildlife Rescue Center under case number 
                        ${currentReportData.caseId}. The specimen was found in ${currentReportData.location} presenting with 
                        ${currentReportData.condition} requiring immediate medical intervention and ongoing rehabilitation care.
                    </p>
                </div>

                <!-- Medical Treatment History -->
                <div class="document-section">
                    <h2 class="section-title">Medical Treatment History</h2>
                    <div id="treatmentEntries"></div>
                </div>

                <!-- Clinical Assessment -->
                <div class="document-section">
                    <h2 class="section-title">Clinical Assessment & Prognosis</h2>
                    <p class="document-paragraph">
                        The patient's condition requires ongoing medical management and monitoring. Treatment response and clinical progression 
                        will determine the rehabilitation potential and prognosis for successful release back to the wild.
                    </p>
                    
                    <p class="document-paragraph">
                        <strong>Primary Diagnosis:</strong> ${currentReportData.condition}
                    </p>
                    
                    <p class="document-paragraph">
                        <strong>Treatment Duration:</strong> ${getTreatmentDuration()} days
                    </p>
                    
                    <p class="document-paragraph">
                        <strong>Current Status:</strong> Under medical care and observation
                    </p>
                </div>

                <!-- Recommendations -->
                <div class="document-section">
                    <h2 class="section-title">Recommendations</h2>
                    <p class="document-paragraph">
                        Based on the current clinical presentation and treatment response, continued monitoring and care are recommended:
                    </p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li>Continue prescribed medication regimen as directed</li>
                        <li>Daily monitoring of patient condition and behavior</li>
                        <li>Regular veterinary assessments</li>
                        <li>Maintain appropriate housing and environmental conditions</li>
                        <li>Document any changes in condition or treatment response</li>
                    </ul>
                </div>
            `;
            
            // Update treatment entries
            updateTreatmentEntries();
        }

        function getTreatmentDuration() {
            if (currentReportData.treatments.length === 0) return 0;
            
            const dates = [...new Set(currentReportData.treatments.map(t => t.date))];
            return dates.length;
        }

        function updateTreatmentEntries() {
            const treatmentContainer = document.getElementById('treatmentEntries');
            treatmentContainer.innerHTML = '';
            
            // Group treatments by date
            const treatmentsByDate = {};
            currentReportData.treatments.forEach(treatment => {
                if (!treatmentsByDate[treatment.date]) {
                    treatmentsByDate[treatment.date] = [];
                }
                treatmentsByDate[treatment.date].push(treatment);
            });
            
            // Generate treatment entries
            Object.keys(treatmentsByDate).forEach((date, index) => {
                const treatments = treatmentsByDate[date];
                const hasCritical = treatments.some(t => 
                    t.observations.includes('Paralysis') || t.observations.includes('unable')
                );
                
                const treatmentEntry = document.createElement('div');
                treatmentEntry.className = 'treatment-entry';
                
                const timeStr = treatments[0].time ? ` (${treatments[0].time})` : '';
                const treatmentType = index === 0 ? 'Initial Treatment' : 'Follow-up Treatment';
                
                let medicationsList = treatments.map(t => 
                    `<li><strong>${t.medication}</strong> - ${t.dosage} administered ${t.route.toLowerCase()} as ${t.classification.toLowerCase()} treatment</li>`
                ).join('');
                
                let observationText = treatments[0].observations;
                let observationClass = hasCritical ? 'critical-note' : 'observation-box';
                let observationIcon = hasCritical ? '‚ö†Ô∏è CRITICAL DEVELOPMENT:' : 'Clinical Observations:';
                
                treatmentEntry.innerHTML = `
                    <div class="treatment-date">${date} - ${treatmentType}${timeStr}</div>
                    <div class="treatment-details">
                        <p>${index === 0 ? 
                            `Upon admission, the patient underwent comprehensive medical assessment by ${treatments[0].veterinarian}. Initial treatment protocol was established to address the primary wing injury and prevent secondary complications.` :
                            `Continued medical management with the same therapeutic protocol. Patient's condition was reassessed, revealing ${hasCritical ? 'concerning neurological symptoms that required immediate attention and modified care approach.' : 'stable condition with continued treatment.'}`
                        }</p>
                        
                        <p><strong>Medications Administered:</strong></p>
                        <ul style="margin-left: 20px; margin-bottom: 10px;">
                            ${medicationsList}
                        </ul>
                        
                        <div class="${observationClass}">
                            <strong>${observationIcon}</strong> ${observationText}${hasCritical ? ' This represents a significant deterioration in neurological function requiring intensive monitoring and potential modification of treatment protocol.' : ''}
                        </div>
                    </div>
                `;
                
                treatmentContainer.appendChild(treatmentEntry);
            });
        }

        function startNewCase() {
            if (confirm('Are you sure you want to start a new case? This will clear all current data.')) {
                currentReportData = {
                    caseId: '',
                    commonName: '',
                    scientificName: '',
                    location: '',
                    condition: '',
                    weight: '',
                    treatments: []
                };
                updateReportDisplay();
                document.getElementById('dataInput').value = '';
                alert('Ready for new case data. Please paste the wildlife acceptance form data.');
            }
        }

        function clearData() {
            document.getElementById('dataInput').value = '';
            alert('Data input cleared.');
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(12);
            doc.setTextColor(44, 62, 80);
            doc.setFont(undefined, 'bold');
            doc.text('DEPARTMENT OF ENVIRONMENT AND NATURAL RESOURCES', 105, 20, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('KAGAWARAN NG KAPALIGIRAN AT LIKAS YAMAN', 105, 28, { align: 'center' });
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Wildlife Rescue Center', 105, 40, { align: 'center' });
            
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('So. Mandaapan, Brgy. New Balamban, Tagum City, Davao del Norte', 105, 48, { align: 'center' });
            
            doc.setLineWidth(0.5);
            doc.line(20, 55, 190, 55);
            
            doc.setFontSize(18);
            doc.setTextColor(44, 62, 80);
            doc.setFont(undefined, 'bold');
            doc.text('Wildlife Rehabilitation Report', 20, 68);
            
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.setFont(undefined, 'normal');
            doc.text('Medical Treatment Documentation', 20, 76);
            
            let yPos = 88;
            
            // Case Summary
            doc.setFontSize(14);
            doc.setTextColor(44, 62, 80);
            doc.setFont(undefined, 'bold');
            doc.text('Case Summary', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.setFont(undefined, 'normal');
            
            const caseInfo = [
                `Case ID: ${currentReportData.caseId}`,
                `Species: ${currentReportData.commonName} (${currentReportData.scientificName})`,
                `Location Found: ${currentReportData.location}`,
                `Initial Condition: ${currentReportData.condition}`,
                `Weight: ${currentReportData.weight}`
            ];
            
            caseInfo.forEach(info => {
                doc.text(info, 20, yPos);
                yPos += 8;
            });
            
            yPos += 10;
            
            // Treatment summary
            doc.setFontSize(14);
            doc.setTextColor(44, 62, 80);
            doc.setFont(undefined, 'bold');
            doc.text('Treatment Summary', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.setFont(undefined, 'normal');
            
            const treatmentsByDate = {};
            currentReportData.treatments.forEach(treatment => {
                if (!treatmentsByDate[treatment.date]) {
                    treatmentsByDate[treatment.date] = [];
                }
                treatmentsByDate[treatment.date].push(treatment);
            });
            
            Object.keys(treatmentsByDate).forEach(date => {
                doc.setFont(undefined, 'bold');
                doc.text(`${date}:`, 20, yPos);
                yPos += 8;
                
                doc.setFont(undefined, 'normal');
                treatmentsByDate[date].forEach(treatment => {
                    const treatmentLine = `‚Ä¢ ${treatment.medication} ${treatment.dosage} (${treatment.route}) - ${treatment.veterinarian}`;
                    doc.text(treatmentLine, 25, yPos);
                    yPos += 6;
                });
                yPos += 5;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text('Report generated on: ' + new Date().toLocaleDateString(), 20, 280);
            doc.text('Wildlife Rehabilitation Center', 20, 285);
            
            const filename = `Wildlife_Document_Report_${currentReportData.caseId.replace(/[^a-zA-Z0-9-]/g, '_')}.pdf`;
            doc.save(filename);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97edd87a84800a88',t:'MTc1NzgzMTUzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
